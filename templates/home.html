{% extends "base.html" %}

{% block title %}Notify - Home{% endblock %}

{# Se você tiver algum CSS que seja EXCLUSIVO da home e não esteja no home.css principal, pode adicionar aqui. Caso contrário, este bloco pode ser omitido. #}
{# {% block head_css %}
    {{ super() }} {# Mantém o CSS do base.html #}
    {# <link rel="stylesheet" href="{{ url_for('static', filename='home_extra.css') }}"> #}
{# {% endblock %} #}

{% block body_content %}
    <header class="fixed-header">
        <div class="header-left">
            <a href="{{ url_for('home') }}" class="logo">Notify<sup>®</sup></a>
        </div>
        <div class="header-right">
            {% if current_user.is_authenticated %}
            <div class="username-wrapper" onclick="toggleDropdown()">
                <span class="username">Olá {{ current_user.nome }}</span>
                <i class="fas fa-user-circle icon-button"></i>
            </div>
            <div class="dropdown-menu" id="userDropdown">
                <a href="{{ url_for('suporte') }}">Falar com suporte</a>
                <a href="{{ url_for('logout') }}" class="logout">Sair da conta</a>
            </div>
            {% else %}
            <a href="{{ url_for('login') }}" class="button-login">Entrar</a>
            <a href="{{ url_for('registrar') }}" class="button-register">Registrar</a>
            {% endif %}
        </div>
    </header>

    <div class="page-content-wrapper">
        <aside class="sidebar">
            <h3>Marcadores</h3>
            <ul class="tag-list">
                <li><a href="{{ url_for('home') }}" class="{% if not active_tag %}active{% endif %}">Todos os Lembretes</a></li>
                {% for tag in marcadores %}
                    <li><a href="{{ url_for('home', tag=tag) }}" class="{% if active_tag == tag %}active{% endif %}">{{ tag }}</a></li>
                {% endfor %}
            </ul>
        </aside>

        <main class="main-content">
            <div class="button-section">
                <a href="{{ url_for('cadastrar') }}">
                    <button class="button-primary">+ Cadastrar novo lembrete</button>
                </a>
            </div>

            <div class="container">
                <div class="quadro">
                    <h2>Lembretes ativos:</h2>
                    {% if a_vencer %}
                        <ul>
                        {% for id_, nome, vencimento, marcador in a_vencer %}
                            <li>
                                <span>{{ nome }} - vence em {{ vencimento.strftime('%d/%m/%Y') }} <span class="tag-label">[{{ marcador }}]</span></span>
                                <a href="{{ url_for('editar', id=id_) }}">Editar</a>
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <p>Nenhum lembrete ativo cadastrado{% if active_tag %} para o marcador "{{ active_tag }}"{% endif %}.</p>
                    {% endif %}
                </div>

                <div class="quadro">
                    <h2>Lembretes expirados:</h2>
                    {% if vencidas %}
                        <ul>
                        {% for id_, nome, vencimento, marcador in vencidas %}
                            <li>
                                <span>{{ nome }} - venceu em {{ vencimento.strftime('%d/%m/%Y') }} <span class="tag-label">[{{ marcador }}]</span></span>
                                <a href="{{ url_for('editar', id=id_) }}">Editar</a>
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <p>Nenhum lembrete expirado cadastrado{% if active_tag %} para o marcador "{{ active_tag }}"{% endif %}.</p>
                    {% endif %}
                </div>
            </div>
        </main>
    </div>

    <footer>
        <p>
            Notify 2025 – Desenvolvido por Cortex-IA Business Intelligence® <br> Todos os direitos reservados.
        </p>
    </footer>
{% endblock %}

{% block body_scripts %}
    <script>
        function toggleDropdown() {
            document.getElementById("userDropdown").classList.toggle("show");
        }

        window.onclick = function(event) {
            if (!event.target.closest('.username-wrapper') && !event.target.closest('.dropdown-menu')) {
                var dropdowns = document.getElementsByClassName("dropdown-menu");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
    </script>
{% endblock %}